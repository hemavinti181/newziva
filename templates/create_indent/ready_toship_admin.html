{% extends 'base.html' %}

{% block htmlbody %}


<div class="right_col" role="main">
          <div class="">
            <div class="page-title">
              <div class="title_left">
                <h3 style="color:#1372ba"><b>Ready to ship</b></h3>
              </div>
              <div class="title_right">
                <div class="col-md-6 col-sm-7 offset-md-9">
                <!--  <a href="add_grnitem"><button type="submit" class="btn btn-success">Add GRN Item</button> -->
                </div>
            </div>
              </div>
            <div class="clearfix"></div>
            <div class="row">
              <div class="col-md-12 col-sm-12 ">
                               			<!-- Search Filter -->
						<form  id="myform" method="POST" action=""  enctype="multipart/form-data">
									{% csrf_token %}
                            {% if request.session.role == 'Admin' %}


                              <!-- <div class="col-md-2  form-group has-feedback">
                              <label for="daterangeselect">Frequency</label>
                                                 <select class="form-control" name="range2" id="range2" hidden>
                            		                    <option value="{{ request.POST.range }}">{{ request.POST.from }}</option>
												</select>
                                <input type="hidden" name="from" id="from" />

                              <select id="daterangeselect" class="form-control" name="range" >

                                  {% for selectrange in selectrange %}
                                       <option value="{{ forloop.counter }}">{{ selectrange.type }}</option>
                                  {% endfor %}
                              </select>
                            </div>-->


                            	<div  class="col-md-2  form-group has-feedback">
													<label> Warehouse</label>
											 <input type="hidden" name="warehousename1" id="warehousename1" />
                                                 <select class="form-control" name="warehouseid2" id="warehouseid2" hidden>
                            		                    <option value="{{ request.POST.warehouseid1 }}">{{  request.POST.warehousename1  }}</option>
												</select>
												<select class="form-control" name="warehouseid1" id="warehouseid1">
													<option value="All">All</option>
													{% for data1 in wh_masterlist %}
															{% if data1.status == 'Active' %}
                            		                    <option value="{{ data1.warehouseid }}">{{ data1.warehousename }}</option>
														{% endif  %}
                                                     {% endfor %}
												</select>
										</div>
											<!--<div  class="col-md-2  form-group has-feedback">
                                                  <select class="form-control" name="regionid2" id="regionid2" hidden>
                            		                    <option value="{{ request.POST.regionid1 }}">{{ request.POST.regionname1 }}</option>
												</select>
													<label> Region</label>
											 <input type="hidden" name="regionname1" id="regionname1" />
												<select class="form-control" name="regionid1" id="regionid1">
													<option value="All">All</option>
												</select>
										</div>-->
											<div  class="col-md-2  form-group has-feedback">
                                                <select class="form-control" name="depoid2" id="depoid2" hidden>
                            		                    <option value="{{ request.POST.depoid1 }}">{{ request.POST.deponame1 }}</option>
												</select>
													<label> Depot</label>
											 <input type="hidden" name="deponame1" id="deponame1" />
												<select class="form-control" name="depoid1" id="depoid1">
													<option value="All">All</option>
												</select>
											</div>

										<div  class="col-md-2  form-group has-feedback">
                                            <select class="form-control" name="busstationid2" id="busstationid2" hidden>
                            		                    <option value="{{ request.POST.busstationid1 }}">{{ request.POST.busstationname1 }}</option>
												</select>
													<label> Bus Station</label>
											 <input type="hidden" name="busstationname1" id="busstationname1" />
												<select class="form-control" name="busstationid1" id="busstationid1">
													<option value="All">All</option>
												</select>
										</div>
                            <div class="col-md-2  form-group has-feedback" id="date-range-fields">
                              <label for="start-date">From Date</label>
                              <input type="date" id="start-date" name="fdate" class="form-control" value="{{ request.POST.fdate }}">
                            </div>

                              <div class="col-md-2  form-group has-feedback"  id="tdate">
                                  <label  for="end-date">To Date</label>
                              <input type="date" id="end-date" name="ldate" class="form-control" value="{{ request.POST.ldate }}">
                            </div>
              {% else %}
                        	<div class="col-sm-3 col-md-3 form-group has-feedback">
									<label class="focus-label">Depot</label>
								     <input type="hidden" name="depotname" id="depotname" />
                                  <input type="hidden" name="wh1" id="wh1" value="{{ mewh }}" />
                                  <input type="hidden" name="reg1" id="reg1" value="{{ mereg }}" />
                                         <input type="hidden" name="depotname1" id="depotname1" value="{{ depo }}" />
												<select class="form-control" name="depoid" id="depoid" >
                                                     <option value=" ">All</option>
                                                    {% for data1 in data1 %}
													    <option value="{{data1.id }}">{{ data1.name }}</option>
                                                    {% endfor %}
												</select>
							</div>

                        	<div class="col-sm-3 col-md-3 form-group has-feedback">
								    <label> Bus Station</label>
                                <input type="hidden" name="busstation1" id="busstation1" value="{{ busstation }}" />
											 <input type="hidden" name="busstationname" id="busstationname" />
												<select class="form-control" name="busstationid" id="busstationid">
													<option value=""> All </option>
												</select>
							</div>
                            <div class="col-sm-2 col-md-2 form-group has-feedback">
									<label class="focus-label">Select Date</label>
									<input class="form-control" type="date" name="date" id="getdate" value="{{ date }}" required>
							</div>


                {% endif %}
<!--<div class="col-md-2 col-sm-2  form-group has-feedback">
                                           <button type="submit" id="button1" name="add" style="margin-top: 25px;" class="btn btn-primary">Search</button>
                                       </div>-->
                        </form>

						</div>
                <div class="x_panel">
                    <div class="clearfix"></div>
                  <div class="x_content">
                      <div class="row">
                          <div class="col-sm-12">
                            <div class="card-box table-responsive">
                    <p class="text-muted font-13 m-b-30">
                    </p>

                        <table id="datatable-buttons" class="display  table-bordered" style="width:100%">
                            <colgroup>

    <col span="1" style="visibility: collapse">
  </colgroup>
                      <thead>
                        <tr>
                            <th></th>

                                    <th>S No</th>
                                    <th>Indent number</th>
                                    <th>DC Number</th>
                                    <th>Indent From</th>
                                    <th>Indent To</th>
                                    <th>Created By</th>
                                    <th>Created On</th>
                            <th>Type</th>
                                    <th>Action</th>
                        </tr>
                      </thead>

                             {% for all_data in indentlist %}
                       <tr>
                           <td></td>
                           <td>{{ forloop.counter }}</td>
                          <td> {{ all_data.indentno }}</td>
                         <td>{{ all_data.dc_number }}</td>
                      <td> {{ all_data.region_name }} </td>
                           <td>{{ all_data.warehouse_name }}</td>
                       <td>{{  all_data.created_by}}</td>
                           <td>{{ all_data.created_on }}</td>
                           <td>{{ all_data.type }}</td>
                            {% if all_data.status == 'Ready to Ship' %}
                                <td>
                                  <a href="/indent_item_list1/{{ all_data.dc_number }}/"><i class="fa fa-edit"></i></a>
                                    <span id="gatepass" data-target=".bs-example-modal-sm"  data-toggle="modal"  onclick="VerifyClick('{{all_data.dc_number }}','{{all_data.warehouse_name}}', '{{all_data.warehouse_id}}','{{all_data.region_name}}','{{all_data.region_id}}','{{all_data.indentno}}')" class="badge badge-info" >Generate Gate Pass </span></a>
                                </td>
                           {% else %}
                           <td>
                                  <a href="/indent_item_list_approve/{{ all_data.dc_number }}/"><span class="badge badge-warning"><i class="fa fa-check-square-o"></i></span></a>
                           </td>
                           {% endif %}
                      </tr>
                      {% endfor %}

                      <tbody>
                      </tbody>
                      </table>
                  </div>
                              <input type="hidden" id="id1" name="id1" />
                  </div>
              </div>
            </div>
                </div>
              </div>
            </div>
          </div>
</div>
</div>

<div class="modal custom-modal bs-example-modal-sm" tabindex="-1" role="dialog" aria-hidden="true">
                                        <div class="modal-dialog modal-sm modal-dialog-centered">
                                            <div class="modal-content style">
<form method="post" action="{% url 'generate_gate_pass' %}">
                                                    {% csrf_token %}
                                        <div class="modal-body">

                                             <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span>
                                            </button>
                                            <h4  id="myModalLabel2" style="text-align:center;color:#14c38e;;">Generate Gate Pass</h4>
                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
									<span aria-hidden="true">&times;</span>
								</button>
                                                <p></p>
                                                <input type="hidden" id="txtHdnId" name="id" />
                                                <input type="hidden" id="rname" name="rname" />
                                                <input type="hidden" id="rid" name="rid" />
                                                <input type="hidden" id="wname" name="wname" />
                                                <input type="hidden" id="wid" name="wid" />
                                                 <input type="hidden" id="indno" name="indno" />
                                                 <div class="col-md-12 col-sm-12  form-group has-feedback">
										            <input type="text" class="form-control" placeholder="Driver Name" name="agentname" id="name">
                                            </div>
                                                 <div class="col-md-12 col-sm-12  form-group has-feedback">
										        <input type="hidden" class="form-control" placeholder="Vehicals Details" name="vehicaldetails1" id="veh1">
                                                	<select class="form-control" name="vehicaldetails" id="veh">
                                                    <option value=" ">Vehical Details</option>
                                                    {% for data1 in vehicals %}
													    <option value="{{data1.vehicleno }}">{{ data1.vehicleno }}</option>
                                                    {% endfor %}
												</select>

										    </div>
                                            <p></p>
                                           <div class="col-md-6 col-sm-6  offset-md-3">
                                                 <button type="submit" class="btn btn-primary">UPDATE</button></a>

                                            </div>
                                            </form>
                                        </div>


                                        </div>
                                    </div>
</div>

<script>
$("#daterangeselect").change(function() {
    var selectedOptionText = $(this).find(":selected").text();
    $("#from").val(selectedOptionText);
});
$("#busstationid").change(function() {
    var selectedOptionText = $(this).find(":selected").text();
    $("#busstationname").val(selectedOptionText);
});

$("#depoid").change(function() {
    var selectedOptionText = $(this).find(":selected").text();
    $("#depotname").val(selectedOptionText);
});

 $(document).ready(function() {

        	var depo = $('#depotname1').val()
        	$.ajax({
            	type: "POST",
            	url: '{% url "get_salebus" %}',
            	data: {
                	'depo':depo,'csrfmiddlewaretoken': '{{ csrf_token }}',       // add the country id to the POST parameters
            	},
			 	success: function(data){
			 		var obj = data.data.dropdownlist
					if(obj) {
			 		$("#busstationid").empty();

                	$.each(obj, function (index, item) {
                    $("#busstationid").append("<option value='" + item.id+ "'>" + item.name+ "</option>");
					});
					var optionValue = $("#busstationid2").val();
                    $("#busstationid").find("option[value='" + optionValue + "']").prop("selected", true);
                	}
             	}
        	});
	$("#depoid").change(function() {
        	var depo = $(this).val();
        	$.ajax({
            	type: "POST",
            	url: '{% url "get_salebus" %}',
            	data: {
                	'depo':depo,'csrfmiddlewaretoken': '{{ csrf_token }}',       // add the country id to the POST parameters
            	},
			 	success: function(data){
			 		var obj = data.data.dropdownlist
					if(obj) {
			 		$("#busstationid").empty();

                	$.each(obj, function (index, item) {
                    $("#busstationid").append("<option value='" + item.id+ "'>" + item.name+ "</option>");
					});
                	}
             	}
        	});
    	});
});


$(document).ready(function(){
  var optionValue = $("#depotname1").val();
  $("#depoid").find("option[value='" + optionValue + "']").prop("selected", true);
})

	$(document).ready(function() {
    // Get the initial warehouse name
  var warehousename = $("#warehouseid1").find(":selected").text();
    console.log(warehousename);
    $.ajax({
        type: "POST",
        url: '{% url "get_storeregion" %}',
        data: {
            'warehouse':warehousename,
            'csrfmiddlewaretoken': '{{ csrf_token }}',
        },
        success: function(data) {
            var obj = data.data.dropdownlist
            if (obj) {
                $("#regionid1").empty();

                $.each(obj, function(index, item) {
                    $("#regionid1").append("<option value='" + item.id + "'>" + item.name + "</option>");
                });
                var optionValue = $("#regionid2").val();
                $("#regionid1").find("option[value='" + optionValue + "']").prop("selected", true);
            }
        }
    });

    $("#warehouseid1").change(function() {
        var warehousename = $(this).find(":selected").text();
        $.ajax({
            type: "POST",
            url: '{% url "get_storeregion" %}',
            data: {
                'warehouse':warehousename,
                'csrfmiddlewaretoken': '{{ csrf_token }}',
            },
            success: function(data) {
                var obj = data.data.dropdownlist
                if (obj) {
                    $("#regionid1").empty();

                    $.each(obj, function(index, item) {
                        $("#regionid1").append("<option value='" + item.id + "'>" + item.name + "</option>");
                    });
                }
            }
        });
    });
 });
 $(document).ready(function() {
    // Get the initial warehouse name
    var warehousename = $("#warehouseid2").find(":selected").text();
    var regionname = $("#regionid1").val();
    // Send an AJAX request to get the storeregion dropdown options
    $.ajax({
        type: "POST",
        url: '{% url "get_storedepo" %}',
      data: {
                	'warehouse':warehousename,'region':regionname,'csrfmiddlewaretoken': '{{ csrf_token }}',       // add the country id to the POST parameters
            	},
        success: function(data) {
            var obj = data.data.dropdownlist
            if (obj) {
                $("#depoid1").empty();

                $.each(obj, function(index, item) {
                    $("#depoid1").append("<option value='" + item.id + "'>" + item.name + "</option>");
                });
                 var optionValue = $("#depoid2").val();
                 $("#depoid1").find("option[value='" + optionValue + "']").prop("selected", true);
            }
        }
    });
    	$("#regionid1").change(function() {
    		var warehousename = $('#warehouseid1').find(":selected").text();
        	var regionname = $('#regionid1').val();
        	$.ajax({
            	type: "POST",
            	url: '{% url "get_storedepo" %}',
            	data: {
                	'warehouse':warehousename,'region':regionname,'csrfmiddlewaretoken': '{{ csrf_token }}',       // add the country id to the POST parameters
            	},
			 	success: function(data){
			 		var obj = data.data.dropdownlist
					if(obj) {
			 		$("#depoid1").empty();
                	$.each(obj, function (index, item) {
                    $("#depoid1").append("<option value='" + item.id+ "'>" + item.name+ "</option>");
					});

                	}
             	}
        	});
    	});
 });
    $(document).ready(function() {
    		var warehousename = $('#warehouseid2').find(":selected").text();
        	var regionname = $('#regionid2').val();
        	var depo = $('#depoid2').val()
        	$.ajax({
            	type: "POST",
            	url: '{% url "get_storebus" %}',
            	data: {
                	'depo':depo,'warehouse':warehousename,'region':regionname,'csrfmiddlewaretoken': '{{ csrf_token }}',       // add the country id to the POST parameters
            	},
			 	success: function(data){
			 		var obj = data.data.dropdownlist
					if(obj) {
			 		$("#busstationid1").empty();

                	$.each(obj, function (index, item) {
                    $("#busstationid1").append("<option value='" + item.id+ "'>" + item.name+ "</option>");
					});
					var optionValue = $("#busstationid2").val();
                    $("#busstationid1").find("option[value='" + optionValue + "']").prop("selected", true);
                	}
             	}
        	});

    	$("#depoid1").change(function() {
    		var warehousename = $('#warehouseid1').find(":selected").text();
        	var regionname = $('#regionid1').val();
        	var depo = $(this).val();
        	$.ajax({
            	type: "POST",
            	url: '{% url "get_storebus" %}',
            	data: {
                	'depo':depo,'warehouse':warehousename,'region':regionname,'csrfmiddlewaretoken': '{{ csrf_token }}',       // add the country id to the POST parameters
            	},
			 	success: function(data){
			 		var obj = data.data.dropdownlist
					if(obj) {
			 		$("#busstationid1").empty();

                	$.each(obj, function (index, item) {
                    $("#busstationid1").append("<option value='" + item.id+ "'>" + item.name+ "</option>");
					});

                	}
             	}
        	});
        });
});
 $("#warehouseid1").change(function() {
  var selectedOptionText = $(this).find(":selected").text();
  $("#warehousename1").val(selectedOptionText);
});
$("#regionid1").change(function() {
  var selectedOptionText = $(this).find(":selected").text();
  $("#regionname1").val(selectedOptionText);
});
$("#depoid1").change(function() {
  var selectedOptionText = $(this).find(":selected").text();
("#deponame1").val(selectedOptionText);
});
$("#busstationid1").change(function() {
  var selectedOptionText = $(this).find(":selected").text();
  $("#busstationname1").val(selectedOptionText);

});
$(document).ready(function(){
  var optionValue = $("#warehouseid2").val();
  $("#warehouseid1").find("option[value='" + optionValue + "']").prop("selected", true);
  var optionValue1 = $("#range2").val();
  $("#daterangeselect").find("option[value='" + optionValue1 + "']").prop("selected", true);
})


  // Add an event listener to the form elements
  document.addEventListener("DOMContentLoaded", function() {
    var form = document.getElementById("myform");

    // Listen for changes in the form elements
    form.addEventListener("change", function() {
      var warehouseValue = document.getElementById("warehouseid1").value;
      //var regionValue = document.getElementById("regionid1").value;
      var depotValue = document.getElementById("depoid1").value;
      var busstationValue = document.getElementById("busstationid1").value;
      var startDateValue = document.getElementById("start-date").value;
      var endDateValue = document.getElementById("end-date").value;

      // Check if any of the fields have a non-"All" value
      if (
        warehouseValue !== "All" ||
         warehouseValue == "All" ||
        //regionValue !== "All" ||
        depotValue !== "All" ||
          depotValue == "All" ||
        busstationValue !== "All" ||
         busstationValue == "All"

      ) {
        // Submit the form programmatically
        form.submit();
      } else if (startDateValue !== "" || endDateValue !== "") {
        // Submit the form programmatically if either start date or end date is filled
        form.submit();
      }

    });
    form.addEventListener("change", function() {
      // Set the hidden input values before submitting the form
      var selectedOptionText = $('#warehouseid1').find(":selected").text();
      $("#warehousename1").val(selectedOptionText);
      //selectedOptionText = $('#regionid1').find(":selected").text();
      //$("#regionname1").val(selectedOptionText);
      selectedOptionText = $('#depoid1').find(":selected").text();
      $("#deponame1").val(selectedOptionText);
      selectedOptionText = $('#busstationid1').find(":selected").text();
      $("#busstationname1").val(selectedOptionText);
      var selectedOptionText = $('#daterangeselect').find(":selected").text();
      $("#from").val(selectedOptionText);
 });
  });

  function VerifyClick(id,tname,tid,fname,fid,indno){
$("#remarks").val(" ");
$("#txtHdnId").val(id);
$("#wname").val(tname);
$("#wid").val(tid);
$("#rname").val(fname);
$("#rid").val(fid);
$("#indno").val(indno);
}




</script>

{% endblock %}




